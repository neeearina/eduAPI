# tyumeneduAPI

API c информацией о кружках и занятиях в городе Тюмени

# БД с таблицей

https://dbdiagram.io/d/eduAPI-65b0f548ac844320ae9e6953

# Данные для бд

Для заполнения БД тестовыми данными необходимо запустить файл app/fake_data.py
Для сохранения данных в фикстуры запустить файл fixtures/load.py
Для заполнения бд данными из фикстур запустить файл fixtures/dump.py
---

# Работа с alembic

### Установить и инициализировать

```commandline
pip install alembic
```

```commandline
alembic init migrations
```

#### После инициализации будет создана директория *migrations* (с файлами *readme*, *env.py*, *script.py.mako*).

#### В директории, где выполнялся скрипт появляется файл *alembic.ini*.

### Настройка

* В файле *alembic.ini* настроить *sqlalchemy.url* - указать путь до базы данных.

* В файле *env.py* yастроить переменную *target_metadata*, в которую передается базовый класс для моделей-таблиц.

* Импорты классов таблиц-моделей лучше сделать в файл *__init__* в том же пакете, где объявлен базовый класс.

### Первая миграция

```commandline
alembic revision --autogenerate -m 'initial'
```

*initial* - название первой миграции

### Применить миграцию

```commandline
alembic upgrade 4be659b1e34b
```

*4be659b1e34b* - хеш миграции

### Если в таблицах что-то изсенилось, то снова сгенерировать миграцию и применить ее.

# Запуск сервера

## Перейти в папку с главным файлом запуска из корневой директории

```commandline
cd app
```

## Запустить сервер командой

```commandline
uvicorn main:app --reload
```

## Перейти по ссылке в терминале вида *http://127.0.0.1:8000*

## Страница с документацией располагается по пути /docs

# Про работу с авторизацией

1. Сначала пользователь регистрируется по ендпоинту /users
2. Далее по ендпоинту /login отправляет данные для получения jwt-токена
3. jwt-токен можно использовать для защищенных роутов (Token Bearer)
